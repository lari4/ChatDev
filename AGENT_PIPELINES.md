# ChatDev Agent Pipelines Documentation

Этот документ описывает все возможные схемы работы агентов в ChatDev - как организованы пайплайны, какие промты вызываются, как передаются данные между фазами.

## Оглавление

1. [Общая архитектура](#общая-архитектура)
2. [Типы фаз](#типы-фаз)
3. [Основной пайплайн разработки (Default)](#основной-пайплайн-разработки-default)
4. [Пайплайны отдельных фаз](#пайплайны-отдельных-фаз)

---

## Общая архитектура

ChatDev использует архитектуру, основанную на **цепочке фаз** (Chain of Phases), где каждая фаза выполняет определенную задачу в процессе разработки ПО.

### Основные компоненты:

```
┌─────────────────────────────────────────────────────────────┐
│                       ChatChain                              │
│  (Главный оркестратор всего процесса разработки)            │
└────────────────────┬────────────────────────────────────────┘
                     │
                     │ управляет
                     ▼
┌─────────────────────────────────────────────────────────────┐
│                      ChatEnv                                 │
│  (Глобальное окружение с состоянием: код, модальность, и тд)│
└────────────────────┬────────────────────────────────────────┘
                     │
                     │ проходит через
                     ▼
┌─────────────────────────────────────────────────────────────┐
│                   Phase Chain                                │
│  (Последовательность фаз из ChatChainConfig.json)           │
│                                                              │
│  Phase 1 → Phase 2 → ... → Phase N                          │
└─────────────────────────────────────────────────────────────┘
```

### Передача данных между фазами:

```
ChatEnv (Глобальное состояние)
├── task_prompt          (Задача пользователя)
├── modality             (Тип продукта: Application, Website, etc)
├── language             (Язык программирования: Python, Java, etc)
├── ideas                (Креативные идеи для реализации)
├── codes                (Исходный код проекта)
├── comments             (Комментарии от Code Reviewer)
├── test_reports         (Отчеты о тестировании)
├── error_summary        (Резюме ошибок)
├── images               (Описания графических элементов)
├── requirements         (Зависимости проекта)
└── ... (другие данные)

Каждая фаза:
1. Читает необходимые данные из ChatEnv
2. Выполняет диалог между агентами с использованием промтов
3. Записывает результаты обратно в ChatEnv
4. Передает управление следующей фазе
```

---

## Типы фаз

ChatDev поддерживает два типа фаз:

### 1. SimplePhase (Простая фаза)

Одиночная фаза с диалогом между двумя ролями.

**Структура:**
```
┌──────────────────────────────────────────┐
│           SimplePhase                     │
├──────────────────────────────────────────┤
│                                          │
│  User Role (начинает диалог)            │
│         │                                │
│         │ phase_prompt + placeholders   │
│         ▼                                │
│  Assistant Role (отвечает)              │
│         │                                │
│         │ ответ с решением              │
│         ▼                                │
│  [возможно несколько раундов]           │
│         │                                │
│         ▼                                │
│  Результат → ChatEnv                    │
│                                          │
└──────────────────────────────────────────┘
```

**Параметры:**
- `max_turn_step`: максимальное число раундов диалога (-1 = без ограничения, используется default 10)
- `need_reflect`: требуется ли рефлексия (дополнительная проверка результата)

### 2. ComposedPhase (Составная фаза)

Фаза, состоящая из нескольких SimplePhase, выполняемых в цикле.

**Структура:**
```
┌──────────────────────────────────────────────────┐
│           ComposedPhase                          │
├──────────────────────────────────────────────────┤
│                                                  │
│  Цикл (до cycleNum раз):                        │
│  ┌────────────────────────────────────────┐     │
│  │  Composition[0] (SimplePhase)          │     │
│  │    ▼                                   │     │
│  │  Composition[1] (SimplePhase)          │     │
│  │    ▼                                   │     │
│  │  ...                                   │     │
│  │    ▼                                   │     │
│  │  Composition[n] (SimplePhase)          │     │
│  └────────────────────────────────────────┘     │
│         │                                        │
│         │ Проверка условия выхода               │
│         ▼                                        │
│  [если <INFO> Finished → выход из цикла]        │
│  [иначе → следующая итерация]                   │
│                                                  │
└──────────────────────────────────────────────────┘
```

**Параметры:**
- `cycleNum`: максимальное число итераций цикла
- `Composition`: массив SimplePhase, выполняемых в каждой итерации

**Условие выхода:** Если любая фаза в Composition возвращает `<INFO> Finished`, цикл прерывается.

---
